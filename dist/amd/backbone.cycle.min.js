// Backbone.Cycle, v1.0.0
// Copyright (c)2014 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.cycle

!function(a,b){if("object"==typeof exports){var c=require("underscore"),d=require("backbone"),e=require("backbone.picky");module.exports=b(c,d,e)}else"function"==typeof define&&define.amd&&define(["underscore","backbone","backbone.picky"],b)}(this,function(a,b){"option strict";return function(a,b){"use strict";a.Cycle={Collection:{_at_looped:function(a){var b=a%this.length;return 0>b&&(b=this.length+b),this.at(b)}},Model:{ahead:function(a,b){var c=b||this.collection,d=c.indexOf(this);if(-1===d)throw new Error("Model "+this.cid+"doesn't exist in the collection.");return c._at_looped(d+a)},behind:function(a,b){return this.ahead(-a,b)},next:function(a){return this.ahead(1,a)},prev:function(a){return this.behind(1,a)},aheadNoLoop:function(a,b){var c=b||this.collection,d=c.indexOf(this);if(-1===d)throw new Error("Model "+this.cid+"doesn't exist in the collection.");return c.at(d+a)},behindNoLoop:function(a,b){return this.aheadNoLoop(-a,b)},nextNoLoop:function(a){return this.aheadNoLoop(1,a)},prevNoLoop:function(a){return this.behindNoLoop(1,a)}}},a.Cycle.SelectableModel=function(){},b.extend(a.Cycle.SelectableModel.prototype,a.Cycle.Model),a.Cycle.SelectableModel.applyTo=function(c){a.Picky.Selectable.applyTo(c),b.extend(c,new a.Cycle.SelectableModel)},a.Cycle.SelectableCollection=function(){},b.extend(a.Cycle.SelectableCollection.prototype,a.Cycle.Collection,{selectAt:function(a){var b=this.at(a);if(!b)throw new Error("Model with index "+a+" doesn't exist in the collection and can't be selected.");b.select()},selectNext:function(){return this.next().select(),this},selectPrev:function(){return this.prev().select(),this},selectNextNoLoop:function(){var a=this.nextNoLoop();return a&&a.select(),this},selectPrevNoLoop:function(){var a=this.prevNoLoop();return a&&a.select(),this},ahead:function(a){if(!this.selected)throw new Error("Illegal call of SelectableCollection navigation method. No model had been selected to begin with.");return this._at_looped(this.indexOf(this.selected)+a)},behind:function(a){return this.ahead(-a)},next:function(){return this.ahead(1)},prev:function(){return this.behind(1)},aheadNoLoop:function(a){if(!this.selected)throw new Error("Illegal call of SelectableCollection navigation method. No model had been selected to begin with.");return this.at(this.indexOf(this.selected)+a)},behindNoLoop:function(a){return this.aheadNoLoop(-a)},nextNoLoop:function(){return this.aheadNoLoop(1)},prevNoLoop:function(){return this.behindNoLoop(1)},selectInitial:function(){this.length&&!this.selected&&"first"===this.initialSelection&&this.first().select()},selectOnRemove:function(a,b,c){var d,e;c||(c={}),"remove"===c._externalEvent&&(this.selectIfRemoved&&"none"===this.selectIfRemoved||!this.length||(e=c.index,d=-1!==this.selectIfRemoved.indexOf("next")?e:e-1,-1!==this.selectIfRemoved.indexOf("NoLoop")&&(d=Math.max(Math.min(d,this.length-1),0)),this._at_looped(d).select()))}}),a.Cycle.SelectableCollection.applyTo=function(c,d,e){var f,g,h;if(e||(e={}),c.initialSelection=e.initialSelection||"none",c.selectIfRemoved=e.selectIfRemoved||"none",!b.contains(["first","none"],c.initialSelection))throw new Error('Invalid initialSelection value "'+c.initialSelection+'"');if(!b.contains(["prev","next","prevNoLoop","nextNoLoop","none"],c.selectIfRemoved))throw new Error('Invalid selectIfRemoved value "'+c.selectIfRemoved+'"');f="none"!==c.initialSelection,g="none"!==c.selectIfRemoved,h=e.enableModelSharing||f||g,h?a.Picky.SingleSelect.applyTo(c,d):a.Picky.SingleSelect.applyTo(c),b.extend(c,new a.Cycle.SelectableCollection),g&&c.listenTo(c,"deselect:one",c.selectOnRemove),f&&(!c.selected&&d&&d.length&&(c.selected=d[0],d[0].select()),c.listenTo(c,"add",c.selectInitial),c.listenTo(c,"reset",c.selectInitial))}}(b,a),b.Cycle});