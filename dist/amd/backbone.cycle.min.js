// Backbone.Cycle, v2.1.3
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.cycle


!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("underscore"),require("backbone"),require("backbone.select")):"function"==typeof define&&define.amd&&define(["underscore","backbone","backbone.select"],b)}(this,function(_,Backbone){"use strict";return function(Backbone,_){function a(a,b){var c=a%b.length;return 0>c&&(c=b.length+c),b.at(c)}function b(a,b){var c=a>=0&&a<b.length;return c?b.at(a):void 0}function c(a){return!isNaN(a)&&parseInt(Number(a),10)==a&&!isNaN(parseInt(a,10))}function d(a,b){return"first"===a?0:"last"===a?b.length-1:parseInt(a,10)}function e(a,b,c){var d=a._cycleOpts[b],e=_.isObject(d)?_.values(d):[d],f=_.isFunction(c);_.each(e,function(a){var e,g=f?c(a):_.contains(c,a);if(!g)throw e=b+' option: Invalid value "'+a+'"',_.isObject(d)&&(e+=" inside hash"),new Error(e)})}function f(a,b){var c=a._cycleOpts[b],d=_.keys(c),e=_.intersection(a._pickyIgnoredLabels,d);if(e.length)throw e=_.map(e,function(a){return'"'+a+'"'}),new Error("Conflicting options: Can't define "+b+" behaviour for label "+e.join(", ")+" because it is ignored in the collection.")}function g(a){var b=function(a){return"none"!==a};return _.isObject(a)?_.some(a,b):b(a)}function h(a,b){var c={},d=a._cycleOpts[b];_.isObject(d)?_.each(d,function(a,b){a&&"none"!==a&&(c[b]=a)}):d&&"none"!==d&&(c[a._pickyDefaultLabel]=d),a._cycleOpts[b]=c}var i={Model:{ahead:function(b,c){var d=c||this.collection,e=d.indexOf(this);if(-1===e)throw new Error("Model "+this.cid+"doesn't exist in the collection.");return a(e+b,d)},behind:function(a,b){return this.ahead(-a,b)},next:function(a){return this.ahead(1,a)},prev:function(a){return this.behind(1,a)},aheadNoLoop:function(a,c){var d=c||this.collection,e=d.indexOf(this);if(-1===e)throw new Error("Model "+this.cid+"doesn't exist in the collection.");return b(e+a,d)},behindNoLoop:function(a,b){return this.aheadNoLoop(-a,b)},nextNoLoop:function(a){return this.aheadNoLoop(1,a)},prevNoLoop:function(a){return this.behindNoLoop(1,a)},_cycleType:"Backbone.Cycle.Model"},SelectableCollection:{selectAt:function(a,c){var d=b(a,this);if(!d)throw new Error("Model with index "+a+" doesn't exist in the collection and can't be selected.");return this.select(d,c),this},selectNext:function(a){return this.select(this.next(a),a),this},selectPrev:function(a){return this.select(this.prev(a),a),this},selectNextNoLoop:function(a){var b=this.nextNoLoop(a);return b&&this.select(b,a),this},selectPrevNoLoop:function(a){var b=this.prevNoLoop(a);return b&&this.select(b,a),this},ahead:function(b,c){var d=c&&c.label||this._pickyDefaultLabel;if(!this[d])throw new Error('Illegal call of SelectableCollection navigation method. No model had been selected to begin with (using label "'+d+'").');return a(this.indexOf(this[d])+b,this)},behind:function(a,b){return this.ahead(-a,b)},next:function(a){return this.ahead(1,a)},prev:function(a){return this.behind(1,a)},aheadNoLoop:function(a,c){var d=c&&c.label||this._pickyDefaultLabel;if(!this[d])throw new Error('Illegal call of SelectableCollection navigation method. No model had been selected to begin with (using label "'+d+'").');return b(this.indexOf(this[d])+a,this)},behindNoLoop:function(a,b){return this.aheadNoLoop(-a,b)},nextNoLoop:function(a){return this.aheadNoLoop(1,a)},prevNoLoop:function(a){return this.behindNoLoop(1,a)},selectInitial:function(){var a,c=arguments.length&&!(arguments[0]instanceof Backbone.Model),e="_cycle_skipSelectInitial_";_.each(this._cycleOpts.autoSelect,function(f,g){var h,i=e+g;!this.length||this[g]||this[i]||(a=d(f,this.models),c||this.find(function(a){return a[g]})&&(this[i]=!0),!this[i]&&b(a,this)&&(h=c?{label:g,_silentLocally:!0}:{label:g},this.selectAt(a,h))),this[g]&&this[i]&&delete this[i]},this)},selectOnRemove:function(b,c,d){var e,f,g=d&&d.label||c._pickyDefaultLabel,h=this._cycleOpts.selectIfRemoved&&this._cycleOpts.selectIfRemoved[g];d||(d={}),"remove"===d._externalEvent&&h&&this.length&&(f=d.index,e=-1!==h.indexOf("next")?f:f-1,-1!==h.indexOf("NoLoop")&&(e=Math.max(Math.min(e,this.length-1),0)),this.select(a(e,this),d))},_cycleType:"Backbone.Cycle.SelectableCollection"}};Backbone.Cycle={Model:{applyTo:function(a){_.extend(a,i.Model)}},SelectableModel:{applyTo:function(a,b){Backbone.Select.Me.applyTo(a,b),_.extend(a,i.Model,{_cycleType:"Backbone.Cycle.SelectableModel"})}},SelectableCollection:{applyTo:function(a,b,j){var k,l,m,n;if(arguments.length<2)throw new Error("The `models` parameter has not been passed to Backbone.Cycle.SelectableCollection.applyTo. Its value can be undefined if no models are passed in during instantiation, but even so, it must be provided.");j||(j={}),a._cycleOpts={},a._cycleOpts.autoSelect=j.autoSelect||j.initialSelection||"none",a._cycleOpts.selectIfRemoved=j.selectIfRemoved||"none",e(a,"autoSelect",function(a){return _.contains(["first","last","none"],a)||c(a)}),e(a,"selectIfRemoved",["prev","next","prevNoLoop","nextNoLoop","none"]),k=g(a._cycleOpts.autoSelect),l=g(a._cycleOpts.selectIfRemoved),m=j.enableModelSharing||k||l,Backbone.Select.One.applyTo(a,b,_.extend({},j,{enableModelSharing:m})),_.extend(a,i.SelectableCollection),h(a,"autoSelect"),h(a,"selectIfRemoved"),f(a,"autoSelect"),f(a,"selectIfRemoved"),l&&a.listenTo(a,"deselect:one",a.selectOnRemove),k&&(b&&b.length&&_.each(a._cycleOpts.autoSelect,function(c,e){a[e]||(n=d(c,b),b[n]&&(a[e]=b[n],b[n].select({label:e})))}),a.listenTo(a,"add",a.selectInitial),a.listenTo(a,"reset",a.selectInitial))}}}}(Backbone,_),Backbone.Cycle});
//# sourceMappingURL=backbone.cycle.min.js.map